<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Title</title>
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link
				href="https://fonts.googleapis.com/css2?family=Abel&family=Cairo&family=Cantarell&family=Jost&family=Noto+Sans&family=Nunito+Sans&family=Quattrocento+Sans&display=swap"
				rel="stylesheet">
		<link rel="stylesheet" href="/static/dialogue/style.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
		<script src="https://unpkg.com/vue@next"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
																																												 integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
						integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
						crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
						integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
						crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
						integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
						crossorigin="anonymous"></script>

	</head>

	<body>
		<div class="container">


			<!-- Modal -->
			<div class="modal fade" data-focus="true" id="consentModal" tabindex="-1" role="dialog"
																																								aria-labelledby="Consent background" aria-hidden="true">
				<div class="modal-dialog model-dialogue-centered modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">IRB Consent Background</h5>
						</div>
						<div id="consent-background" class="modal-body">
							<iframe style="width: 100%; height: 400px;"
											src="/static/dialogue/IRB_consent_background.html"></iframe>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
																		onclick="window.frames[0].print();">Print</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">Go to the study</button>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="my-container" id="app">
			<div class='chat-box'>
				<div class="speech-bubble-container prompt" v-if='prompt != ""'>
					<div class="speech-bubble"> {{prompt}} </div>
				</div>
				<div class="transcript">
					<div class="speech-bubble-container" 
							 :class="[utterance.speaker, {
											 selected: 'selectedUtterances' in this.currentQuestion && this.currentQuestion.selectedUtterances.includes(index), 
											 positive: 'turnAnnotations' in this.currentQuestion && this.currentQuestion.turnAnnotations[index] === 'positive', 
											 negative: 'turnAnnotations' in this.currentQuestion && this.currentQuestion.turnAnnotations[index] === 'negative', 
											 turnlevel: currentQuestion.type==='turn-binary' || currentQuestion.type==='turn-ternary' }, ]"
							 v-for="(utterance, index) in utterances">
						<div class='speech-bubble-gutter'>
							<input v-if="currentQuestion.type=='turn-binary' && utterance.speaker=='bot'" type="checkbox" @click="toggleSelectedUtterance(index);"
																																														:checked="this.currentQuestion.selectedUtterances.includes(index)">
							<div v-if="currentQuestion.type=='turn-ternary' && utterance.speaker=='bot'" class="ternary-btn-group btn-group" role="group" aria-label="Basic radio toggle button group">
								<label class="btn" :class="this.currentQuestion.turnAnnotations[index]==='positive'? 'btn-success': 'btn-outline-success'"><i class="bi bi-emoji-smile"></i>
									<input type="radio" class="btn-check" name="turn-{{index}}" autocomplete="off" @click="ternaryLabel(index, 'positive');">
								</label>

								<label class="btn" :class="this.currentQuestion.turnAnnotations[index]==='neutral'? 'btn-secondary': 'btn-outline-secondary'"><i class="bi bi-emoji-neutral"></i>
									<input type="radio" class="btn-check" name="turn-{{index}}"  autocomplete="off"   @click="ternaryLabel(index, 'neutral');">
								</label>

								<label class="btn" :class="this.currentQuestion.turnAnnotations[index]==='negative'? 'btn-danger': 'btn-outline-danger'"><i class="bi bi-emoji-frown"></i>
									<input type="radio" class="btn-check" name="turn-{{index}}" autocomplete="off"  @click="ternaryLabel(index, 'negative');">
								</label>
							</div>
						</div>
						<div class='speech-bubble'>{{utterance.text}}</div>
					</div>
				</div>
				<form v-if="!isConversationOver" @submit.prevent="submit" class="next-utterance-input" autocomplete="off"
																																															 name="newUtteranceForm">
					<input type="text" name="newUtterance" class="new-utterance" required v-model="newUtterance" />
					<!--<textarea type="text" name="newUtterance" class="new-utterance" required v-model="newUtterance" oninput="this.style.height = '';this.style.height = (this.scrollHeight) + 'px'"></textarea>-->
					<button type="submit" class="submit" value="Send">
						<svg class="send-icon" viewBox="0 0 24 24" aria-labelledby="title">
							<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
							<path d="M0 0h24v24H0z" fill="none" />
							</use>
						</svg>
					</button>
				</form>
			</div>

			<div id="interview-questions" class="bottom-form">
				<div class="form-row">
					<button id="endConversation" class='btn btn-warning' :disabled=" utterances.length < 2"
									@click="endConversation()" v-if="!isConversationOver" type="button">End Conversation</button>
					<template v-else>
						Question {{currentQuestionIdx+1}} of {{questions.length}} <br>
						<div class="form-row">
							<label class='instruction' for="{{currentQuestion.tag}}"> {{currentQuestion.text}}</label>
							<div class='ternary-options'>
								<ul class="list-group" v-if="currentQuestion.type=='turn-ternary'">  
									<li class="list-group-item"> <label class="btn btn-success"><i class="bi bi-emoji-smile"></i></label> &nbsp; {{currentQuestion.options.positive}} </li>
									<li class="list-group-item"> <label class="btn btn-secondary"><i class="bi bi-emoji-neutral"></i></label> &nbsp; {{currentQuestion.options.neutral}} </li>
									<li class="list-group-item"> <label class="btn btn-danger"><i class="bi bi-emoji-frown"></i></label> &nbsp; {{currentQuestion.options.negative}} </li>
								</ul>
							</div>
						</div>
						<div class="form-row">
							<select class="form-select" v-if="currentQuestion.type=='likert'"
																					v-model="currentQuestion.rating" id="{{currentQuestion.tag}}"
																																					 name="{{currentQuestion.tag}}">
								<option disabled value="">Please select one</option>
								<option v-for="option in currentQuestion.options">{{option}}</option>
							</select>
							<div class="form-check" v-else-if="currentQuestion.type=='turn-binary' || currentQuestion.type=='turn-ternary'">
								<input class="form-check-input" type="checkbox" id="{{currentQuestion.tag}}"
																																name="{{currentQuestion.tag}}" :checked="currentQuestion.notaUtterance"
																																@change="toggleNotaUtterance">
								<label v-if="currentQuestion.type=='turn-binary'" class="form-check-label" for="{{currentQuestion.tag}}">None of the utterances</label>
								<label v-if="currentQuestion.type=='turn-ternary'" class="form-check-label" for="{{currentQuestion.tag}}">All the utterances are {{currentQuestion.options.neutral}}</label>

							</div>
							<template v-else-if="currentQuestion.type=='freeForm'">
								<input v-model='currentQuestion.answer' id="{currentQuestion.tag}"
																												name="{currentQuestion.tag}" rows="5" cols="33"> </textarea>
							</template>

						</div>
						<div class="error" v-if="error">Error: {{error}}</div>
						<div class="success" v-if="success && !optedout">Answers successfully submitted. Survey completion
							code: {{code}}</div>
						<div class="success" v-if="success && optedout">You have successfully opted out. Survey completion
							code: {{code}}</div>
						<div id='bottom-buttons'>
							<div class="btn-group form-row">
								<button class='btn btn-outline-secondary' @click="prevQuestion()"
												:disabled="currentQuestionIdx<=0" type="button">Prev</button>
								<button class='btn btn-outline-success' @click="submitAnswers()" v-if="isInterviewOver"
																																								 type="button">Submit</button>
								<button class='btn btn-outline-primary' v-else @click="nextQuestion()"
												type="button">Next</button>
							</div>
						</div>

					</template>

				</div>
				<div class="form-row">
					<a class="opt-out" data-toggle="modal" data-target="#consentModal"> Read IRB consent background </a>
					&nbsp;
					<a class="opt-out" @click="optout()">Out out of the study </a>
				</div>
			</div>
		</div>
		</div>
		<script src="crfm-wrapper.js"></script>
	</body>

</html>
